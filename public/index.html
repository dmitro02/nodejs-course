<html>
    <body>
        <input type="file" class="file-selector" />
        <br><br>
        <div>
            <input type="button" class="upload-button" value="Upload" />
        </div>
        <br><br>
        <div class="server-message"></div>

        <script>
            const ws = new WebSocket('ws://localhost:8080')

            ws.onopen = (e) => {
                console.log('Connection established')
            };
            
            ws.onmessage = (e) => {
                console.log(`Got data from server: ${e.data}`)
                document.querySelector('.server-message').innerHTML =
                    `<b>Download file: <b>
                     <a href="${e.data}" target="_blank">${e.data}</a>`
            };
            
            ws.onclose = (e) => {
                if (e.wasClean) {
                    console.log('Connection closed')
                } else {
                    console.log('Connection interrupted.', e.reason)
                }
            };
            
            ws.onerror =(err) => {
                console.log(err.message)
            };

            const handleClick = () => {
                const fileSelector = document.querySelector('.file-selector')
                const reader = new FileReader()
                reader.onload = () => ws.send(reader.result)
                const files = fileSelector.files
                files && reader.readAsArrayBuffer(files[0])
            }

            document
                .querySelector('.upload-button')
                .addEventListener('click', handleClick)
        </script>
    </body>
</html>